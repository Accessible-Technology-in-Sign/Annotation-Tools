# Use the headless VNC container as the base image
FROM consol/debian-xfce-vnc

# Metadata
ENV REFRESHED_AT=2024-09-28

# Copy the requirements.txt to the container
COPY requirements.txt /tmp/requirements.txt

# Switch to root user to install additional software
USER 0

# Update package lists and install necessary packages
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        python3 \
        python3-pip \
        python3.11-venv \
        build-essential \
        qtbase5-dev \
        libgl1-mesa-dev \
        libglib2.0-0 \
        libsm6 \
        libxrender1 \
        libfontconfig1 \
        vlc \
    && rm -rf /var/lib/apt/lists/*

# Upgrade pip to the latest version
RUN python3 -m pip install --upgrade pip setuptools wheel --break-system-packages

# Install Python packages from requirements.txt with pip flags to allow system-wide installation
RUN python3 -m pip install --no-cache-dir --break-system-packages -r /tmp/requirements.txt

# Set environment variables for VLC
ENV VLC_PLUGIN_PATH=/usr/lib/x86_64-linux-gnu/vlc/plugins

# Switch back to the default non-root user
USER 1000

# (Optional) Define the default command if needed
# CMD ["start-vnc.sh"]
